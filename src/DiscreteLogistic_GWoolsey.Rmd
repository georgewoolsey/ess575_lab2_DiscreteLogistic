---
title: "ESS 575: Discrete Logistic Lab"
author: "George Woolsey"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    toc: false
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding){ 
    out_dir <- '../';
    rmarkdown::render(inputFile, encoding = encoding, output_file=file.path(dirname(inputFile), out_dir, 'DisrceteLogisticLab_GWoolsey.pdf')) 
  })
---

```{r setup, include=FALSE}
# load packages
library(tidyverse)
library(lubridate)
library(viridis)
library(scales)
```

# Objective

See the course website for a [full lab description](https://nthobbs50.github.io/ESS575/content/labs/DiscreteLogisticR.html). Important R concepts and methods utilized include:

1. writing functions

2. creating data structures

3. looping

4. plotting


# Question 1

\begin{equation}
\tag{1}
x_{t+1} = \lambda x_{t} (1-x_{t})
\end{equation}

Where: 

* $\lambda$ is the per capita rate of population growth 

* $x_{t}$ is the population size at time $t$.

Write an R function for equation 1. Use your function to simulate how population size changes over time in response to variation in the parameter $\lambda$. Set up a model experiment with an outer for loop controlling the value of $\lambda$ to range from .25 to 4.0 in steps of .25. Create an inner loop varying time from 2 to 30 in steps of 1. Assume that the initial condition (i.e., the value of $x$ at time = 1) for the population size is .01. Create a plot of $x$ as a function of time for each value of $\lambda$. You should display your plots with 4 x 4 panels, one panel for each of your simulations. Give each plot a title showing the value of $\lambda$. (Hint, convert the numeric value of $\lambda$ to a character value using z = as.character(lambda) and use main = z as an option in the plot statement). What can you conclude about the effect of $\lambda$ on the dynamics? Use your panel plot to illustrate the points in your discussion.For an engaging time waster, figure out how to put a symbolic $\lambda$ in the title of your plots. So, you will need to combine a symbolic $\lambda$ with a numeric value that changes with each plots title. See ?plotmath for hints.

```{r, warning=F, message=F}
# set up function
fn_x_t <- function(x, t, lambda) {
  x_t <- lambda * x[t-1] * (1 - x[t-1])
  return(x_t)
}

# lambda
lambda <- seq(0.25, 4, 0.25)

# time
t <- seq(2, 30, 1)

# x
x_t1 <- 0.01


dta <- data.frame(
  x = seq(2, 230, 2)
)
# define coefficients
  a <- 72.82
  b <- 0.0156
  c <- 0.8634
# define function
weibull_fn <- function(x) {
  # return
  return(a * ( 1 - exp( -b * (x^c) ) ) )
}

# plot
my_plot <- ggplot(dta, aes(x = dbh)) + 
  geom_function(
    fun = weibull_fn
    , size = 2
    , alpha = 0.8
  ) +
  annotate(
    'text'
    , x = 35
    , y = 50
    , label = "HT == a %*% bgroup('[',1 - italic(e)^(-b %*% DBH^c),']') "
    , parse = TRUE
    , size = 4
  ) +
  labs(
    title = "Weibull Tree Height-Diameter Growth Function"
    , subtitle = expression(paste(
        "example based on coefficients for Ponderosa Pine ("
        , italic("Pinus ponderosa")
        , ")"
      ))
    , caption = paste0(
        "where: a = "
        , as.character(a)
        , "; b = "
        , as.character(b)
        , "; c = "
        , as.character(c)
      )
  ) +
  annotate(
    "text"
    , x = max(dta$dbh) * .9
    , y = 2
    , label = "created by: George Woolsey"
    , size = 3
  ) +
  xlab("Tree DBH (cm)") +
  ylab("Tree Height (m)") +
  theme_bw() +
  theme(
    legend.position="none"
  ) 
```

```{r, warning=F, message=F, eval=FALSE}
# Export PDF
pdf("../plot_assignment1_GWoolsey.pdf", paper = "USr", height = 8.5, width = 11)
print(my_plot)
dev.off()  

```


\newpage

## Literature Cited

**Yang, R. C., Kozak, A., & Smith, J. H. G. (1978).** The potential of Weibull-type functions as flexible growth curves. *Canadian Journal of Forest Research*, **8(4)**, 424-431.


**Zhang, L. (1997).** Cross-validation of non-linear growth functions for modelling tree heightâ€“diameter relationships. *Annals of Botany*, **79(3)**, 251-257.

